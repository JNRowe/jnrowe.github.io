<?xml version='1.0' encoding='UTF-8'?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <id>https://jnrowe.github.io/</id>
  <title>JNRowe - Posts tagged tools</title>
  <updated>2018-12-04T00:00:00+00:00</updated>
  <link href="https://jnrowe.github.io/"/>
  <link href="https://jnrowe.github.io/blog/tag/tools/atom.xml" rel="self"/>
  <generator uri="https://ablog.readthedocs.org/" version="0.10.23">ABlog</generator>
  <subtitle>Ramblings of a tired mind</subtitle>
  <entry>
    <id>https://jnrowe.github.io/articles/redo_ninja_make.html</id>
    <title>while $sun; do make hay; done</title>
    <updated>2018-11-23T00:00:00+00:00</updated>
    <author>
      <name>James Rowe</name>
    </author>
    <content type="html">&lt;section id="while-sun-do-make-hay-done"&gt;

&lt;div class="admonition warning"&gt;
&lt;p class="admonition-title"&gt;Warning&lt;/p&gt;
&lt;p&gt;This is a &lt;strong&gt;massive&lt;/strong&gt; brain dump, which I plan to rewrite in to a series at
some point.  However, until that imaginary date arrives…&lt;/p&gt;
&lt;/div&gt;
&lt;p&gt;I have a fondness for &lt;a class="reference external" href="https://en.m.wikipedia.org/wiki/Make_(software)"&gt;make&lt;/a&gt;, but don’t quite know why.  On some days it is
&lt;em&gt;the&lt;/em&gt; bane of my life, and I feel we could do better.  It is, however,
incredibly useful and allows us to easily perform so many of the repetitive
tasks we in the software world have lucked ourselves in to.&lt;/p&gt;
&lt;p&gt;One project that I’ve worked on for a decade has &lt;em&gt;ten thousand&lt;/em&gt; lines of hand
written &lt;code class="file docutils literal notranslate"&gt;&lt;span class="pre"&gt;Makefile&lt;/span&gt;&lt;/code&gt;s, which is just plain ridiculous.  Nobody should be
hand writing that much build infrastructure, even if it started with good
intentions and a scant 120 lines.&lt;/p&gt;
&lt;section id="which-make"&gt;
&lt;h2&gt;Which &lt;strong class="command"&gt;make&lt;/strong&gt;?&lt;/h2&gt;
&lt;p&gt;A hardly insignificant number of those 10,000 lines are to workaround
incompatibilities in various tools that advertise themselves as &lt;strong class="command"&gt;make&lt;/strong&gt;.
Forcing a dependency on &lt;a class="reference external" href="https://www.gnu.org/software/make/make.html"&gt;GNU make&lt;/a&gt; wouldn’t suddenly drop the line count by
60% or magically transform the robustness of our builds, but it would help.&lt;/p&gt;
&lt;p&gt;I’ll take a tiny example from the project I’m working on right now.  Which
common versions of &lt;strong class="command"&gt;make&lt;/strong&gt; will it fail on and why?&lt;/p&gt;
&lt;div class="highlight-make notranslate"&gt;&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="nf"&gt;MAKE_SUBDIRS &lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;= …

&lt;span class="nf"&gt;m/clean&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="k"&gt;$(&lt;/span&gt;&lt;span class="nv"&gt;subst&lt;/span&gt; &lt;span class="nv"&gt;m&lt;/span&gt;/&lt;span class="nv"&gt;clean&lt;/span&gt;,,&lt;span class="k"&gt;$(&lt;/span&gt;&lt;span class="nv"&gt;MAKE_SUBDIRS&lt;/span&gt;:%=%/&lt;span class="nv"&gt;clean&lt;/span&gt;&lt;span class="k"&gt;))&lt;/span&gt;
    +echo &lt;span class="s2"&gt;&amp;quot;Don’t use &amp;#39;make -n&amp;#39; to test without side effects either&amp;quot;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;We even have a 800 line &lt;code class="file docutils literal notranslate"&gt;&lt;span class="pre"&gt;Makefile.debug&lt;/span&gt;&lt;/code&gt; include which defines
a namespace of subcommands(like the &lt;strong&gt;m&lt;/strong&gt;aintainer namespace above) to aid
when the inevitable errors show up.  Most of the stuff in that file is
&lt;em&gt;absolutely amazing&lt;/em&gt;, I’m working with a few genuine &lt;strong class="command"&gt;make&lt;/strong&gt; masters.&lt;/p&gt;
&lt;p&gt;&lt;em&gt;I am not a&lt;/em&gt; &lt;strong class="command"&gt;make&lt;/strong&gt; &lt;em&gt;master&lt;/em&gt;.&lt;/p&gt;
&lt;p&gt;I often find myself forgetting which &lt;strong class="command"&gt;make&lt;/strong&gt; supports some feature, or which one
fails horribly when you use that one “standard” feature every &lt;strong class="command"&gt;make&lt;/strong&gt; supports.
Even in the minutia of the build there are things that are subobtimal, for
example in the previously mentioned project there are a variety of suffix rules
&lt;em&gt;and&lt;/em&gt; pattern rules which &lt;em&gt;could&lt;/em&gt; be uniform if only we’d managed to force
a specific style&lt;a class="footnote-reference brackets" href="#id8" id="id1"&gt;1&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Late last year I posted the following note:&lt;/p&gt;
&lt;blockquote&gt;
&lt;div&gt;&lt;p&gt;Just finished my 1º &lt;strong&gt;#guile&lt;/strong&gt; &lt;strong&gt;make&lt;/strong&gt; extension… &lt;abbr title="Today I Learned"&gt;TIL&lt;/abbr&gt; none of our &lt;abbr title="Continuous Integration"&gt;CI&lt;/abbr&gt; servers have
&lt;strong&gt;#make&lt;/strong&gt; with &lt;strong&gt;#guile&lt;/strong&gt; support, and many devs have pre-GPL3 make.&lt;/p&gt;
&lt;p class="attribution"&gt;—&lt;a class="reference external" href="https://jnrowe.github.io/mnotes/#2017-12-07T17:40:14+00:00"&gt;2017-12-07T17:40:14+00:00&lt;/a&gt;&lt;/p&gt;
&lt;/div&gt;&lt;/blockquote&gt;
&lt;p&gt;It is still mostly true, our build servers and many developers still don’t have
a &lt;a class="reference external" href="https://www.gnu.org/software/guile/"&gt;guile&lt;/a&gt; enabled &lt;a class="reference external" href="https://www.gnu.org/software/make/make.html"&gt;GNU make&lt;/a&gt;.  The build servers don’t because &lt;code class="docutils literal notranslate"&gt;&lt;span class="pre"&gt;guile&lt;/span&gt;&lt;/code&gt;
support isn’t enabled in the packages for some reason, and the devs that use
systems which refuse to ship a recent enough versions of &lt;a class="reference external" href="https://www.gnu.org/software/make/make.html"&gt;GNU make&lt;/a&gt; to avoid
the GPLv3&lt;a class="footnote-reference brackets" href="#id9" id="id2"&gt;2&lt;/a&gt; don’t have it either.&lt;/p&gt;
&lt;p&gt;There has to be a better way…&lt;/p&gt;
&lt;/section&gt;
&lt;section id="redo"&gt;
&lt;h2&gt;&lt;strong class="command"&gt;redo&lt;/strong&gt;&lt;/h2&gt;
&lt;p&gt;&lt;abbr title="Daniel J. Bernstein"&gt;djb&lt;/abbr&gt;’s &lt;strong class="command"&gt;redo&lt;/strong&gt; is a &lt;em&gt;huge&lt;/em&gt; step in the right
direction&lt;a class="footnote-reference brackets" href="#id10" id="id3"&gt;3&lt;/a&gt;, but its various implementations are plagued by many of the
problems that &lt;strong class="command"&gt;make&lt;/strong&gt; has.  There is &lt;em&gt;no&lt;/em&gt; single tool that can uniformly be
recognised as &lt;strong class="command"&gt;redo&lt;/strong&gt;, in fact it feels like somehow there are as many
implementations of &lt;strong class="command"&gt;redo&lt;/strong&gt; floating around as there are of &lt;strong class="command"&gt;make&lt;/strong&gt; even though it
is &lt;em&gt;thirty years younger&lt;/em&gt;.&lt;/p&gt;
&lt;p&gt;While &lt;strong class="command"&gt;redo&lt;/strong&gt; is awesome in many of its implementations you find yourself having
to remember the idiosyncrasies of yet another collection of slightly
incompatible tools.  If you’re using Avery Pennarun’s popular &lt;a class="reference external" href="https://github.com/apenwarr/redo/"&gt;Python
implementation&lt;/a&gt; then you may not remember to make your &lt;code class="docutils literal notranslate"&gt;&lt;span class="pre"&gt;.do&lt;/span&gt;&lt;/code&gt; files
executable or to give them a proper &lt;code class="docutils literal notranslate"&gt;&lt;span class="pre"&gt;#!&lt;/span&gt;&lt;/code&gt; line, as it doesn’t necessarily
require them.  If you using Jonathan de Boyne Pollard’s impressive &lt;a class="reference external" href="http:/homepage.ntlworld.com./j.deboynepollard/Softwares/redo/"&gt;C
implementation&lt;/a&gt; you may not remember that you don’t have &lt;strong class="command"&gt;redo-stamp&lt;/strong&gt;
available to you.  As &lt;strong class="command"&gt;redo&lt;/strong&gt; is less common specifying the &lt;em&gt;exact&lt;/em&gt; tool you’re
calling &lt;strong class="command"&gt;redo&lt;/strong&gt; is &lt;em&gt;far&lt;/em&gt; easier than with &lt;strong class="command"&gt;make&lt;/strong&gt; though, and I’m yet to see an
angry issue reported in projects that do so&lt;a class="footnote-reference brackets" href="#id11" id="id4"&gt;4&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;So, once you’ve managed to keep your eyes on the shifting landscape — or have
forced a specific implementation of &lt;strong class="command"&gt;redo&lt;/strong&gt; — you have to turn your attention to
your &lt;code class="docutils literal notranslate"&gt;&lt;span class="pre"&gt;.do&lt;/span&gt;&lt;/code&gt; files.  Is &lt;strong class="command"&gt;/bin/sh&lt;/strong&gt; &lt;a class="reference external" href="http://tiswww.case.edu/php/chet/bash/bashtop.html"&gt;bash&lt;/a&gt;, &lt;a class="reference external" href="http://gondor.apana.org.au/~herbert/dash/"&gt;dash&lt;/a&gt;, or something else
entirely?  Is that large &lt;strong class="command"&gt;find&lt;/strong&gt; to &lt;strong class="command"&gt;xargs&lt;/strong&gt; pipe you’re using
to pump &lt;strong class="command"&gt;redo-ifchange&lt;/strong&gt; going to fail because some platform’s
&lt;strong class="command"&gt;find&lt;/strong&gt; treats links differently?  Do you need to specify
&lt;strong class="command"&gt;gsed&lt;/strong&gt; on MacOS to work around issues with the default &lt;strong class="command"&gt;sed&lt;/strong&gt;
command?  As a first port of call &lt;em&gt;at least&lt;/em&gt; run &lt;strong class="command"&gt;checkbashisms&lt;/strong&gt; from
the &lt;a class="reference external" href="https://packages.debian.org/devscripts"&gt;devscripts&lt;/a&gt; package on your public &lt;code class="docutils literal notranslate"&gt;&lt;span class="pre"&gt;.do&lt;/span&gt;&lt;/code&gt; files.&lt;/p&gt;
&lt;p&gt;I mean — to an extent — you need to be on top of these things in your &lt;strong class="command"&gt;make&lt;/strong&gt;
usage too, but you’re likely to have far more complex &lt;code class="docutils literal notranslate"&gt;&lt;span class="pre"&gt;.do&lt;/span&gt;&lt;/code&gt; files than the
shell incantations in your rule’s recipes.&lt;/p&gt;
&lt;div class="admonition tip"&gt;
&lt;p class="admonition-title"&gt;Tip&lt;/p&gt;
&lt;p&gt;If you’re using the Python &lt;strong class="command"&gt;redo&lt;/strong&gt; implementation you should be considering
the speed of the tools too, so as to not adversely affect your build times.
For example, it is good practice to collect &lt;em&gt;all&lt;/em&gt; dependencies before
calling &lt;strong class="command"&gt;redo-ifchange&lt;/strong&gt; instead of staggering their addition
throughout your &lt;code class="docutils literal notranslate"&gt;&lt;span class="pre"&gt;.do&lt;/span&gt;&lt;/code&gt; file as you encounter them.&lt;/p&gt;
&lt;/div&gt;
&lt;p&gt;All this is worth the cost though.  You end up with stable, self encapsulated
build rules such as the following:&lt;/p&gt;
&lt;div class="highlight-sh notranslate"&gt;&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;redo-ifchange ./.meta/cc ./.meta/cflags
&lt;span class="nb"&gt;read&lt;/span&gt; cc &amp;lt; ./.meta/cc
&lt;span class="nb"&gt;read&lt;/span&gt; ccflags &amp;lt; ./.meta/cflags
&lt;span class="nv"&gt;$cc&lt;/span&gt; &lt;span class="nv"&gt;$cflags&lt;/span&gt; -o &lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="nv"&gt;$3&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt; -c &lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="nv"&gt;$2&lt;/span&gt;&lt;span class="s2"&gt;.c&amp;quot;&lt;/span&gt; -MD -MF &lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="nv"&gt;$2&lt;/span&gt;&lt;span class="s2"&gt;.d&amp;quot;&lt;/span&gt;
sed -e &lt;span class="s2"&gt;&amp;quot;s|^&lt;/span&gt;&lt;span class="nv"&gt;$3&lt;/span&gt;&lt;span class="s2"&gt;:||&amp;quot;&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="nv"&gt;$2&lt;/span&gt;&lt;span class="s2"&gt;.d&amp;quot;&lt;/span&gt; &lt;span class="p"&gt;|&lt;/span&gt; xargs redo-ifchange
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;That is a cropped excerpt from a project’s &lt;code class="file docutils literal notranslate"&gt;&lt;span class="pre"&gt;default.o.do&lt;/span&gt;&lt;/code&gt;.  It defines
a rule that builds &lt;code class="docutils literal notranslate"&gt;&lt;span class="pre"&gt;.o&lt;/span&gt;&lt;/code&gt; files from their corresponding &lt;code class="docutils literal notranslate"&gt;&lt;span class="pre"&gt;.c&lt;/span&gt;&lt;/code&gt; file, and it
makes sure those files are rebuilt in the event that you change the value of
&lt;span class="target" id="index-0"&gt;&lt;/span&gt;&lt;a class="reference internal" href="../../glossary.html#envvar-CC"&gt;&lt;code class="xref std std-envvar docutils literal notranslate"&gt;&lt;span class="pre"&gt;CC&lt;/span&gt;&lt;/code&gt;&lt;/a&gt; or &lt;span class="target" id="index-1"&gt;&lt;/span&gt;&lt;a class="reference internal" href="../../glossary.html#envvar-CFLAGS"&gt;&lt;code class="xref std std-envvar docutils literal notranslate"&gt;&lt;span class="pre"&gt;CFLAGS&lt;/span&gt;&lt;/code&gt;&lt;/a&gt;.  It also handles &lt;em&gt;all&lt;/em&gt; the dependencies your
&lt;code class="docutils literal notranslate"&gt;&lt;span class="pre"&gt;#include&lt;/span&gt;&lt;/code&gt; directives gave by taking advantage of the compiler’s knowledge of
the build.  Implementing the same functionality with &lt;strong class="command"&gt;make&lt;/strong&gt; is far more
convoluted, and requires a heap of code if you wish to use finer grained
controls than simply rebuilding &lt;em&gt;everything&lt;/em&gt; by depending on your
&lt;code class="file docutils literal notranslate"&gt;&lt;span class="pre"&gt;Makefile&lt;/span&gt;&lt;/code&gt; from within your rules.&lt;/p&gt;
&lt;p&gt;Still &lt;strong class="command"&gt;redo&lt;/strong&gt; is a big leap forward from plain &lt;strong class="command"&gt;make&lt;/strong&gt;, and I do recommend it.
I even gave a talk on it at &lt;abbr title="London Functional"&gt;LoFu&lt;/abbr&gt; ‘16, and I know
some people switched after hearing that as I’ve been fielding informal support
requests ever since ;)&lt;/p&gt;
&lt;/section&gt;
&lt;section id="gup"&gt;
&lt;h2&gt;&lt;strong class="command"&gt;gup&lt;/strong&gt;&lt;/h2&gt;
&lt;p&gt;I want to give &lt;a class="reference external" href="https://github.com/timbertson/gup/"&gt;Tim Cuthbertson’s gup&lt;/a&gt; an honourable mention here.  &lt;strong class="command"&gt;gup&lt;/strong&gt; is
an improved &lt;strong class="command"&gt;redo&lt;/strong&gt; implementation, but is wholly incompatible with it.  It is
available in both a &lt;a class="reference external" href="https://github.com/timbertson/gup/tree/master/python"&gt;Python&lt;/a&gt; and &lt;a class="reference external" href="https://github.com/timbertson/gup/tree/master/ocaml"&gt;ocaml&lt;/a&gt; version.  It fixes a few of the most
annoying problems in &lt;strong class="command"&gt;redo&lt;/strong&gt;, but operates in largely the same way conceptually.
Any of the skills you’ve learnt with &lt;strong class="command"&gt;redo&lt;/strong&gt; are easy to transfer, and you can
update your builds to use &lt;strong class="command"&gt;gup&lt;/strong&gt; with very little effort.&lt;/p&gt;
&lt;p&gt;I’m a big fan of &lt;strong class="command"&gt;gup&lt;/strong&gt;, and for a couple of years I even used it to power my
home directory having &lt;span class="xref std std-doc"&gt;moved on from make&lt;/span&gt;.  An
excerpt from my homedir’s debug support can perhaps serve as an example of its
usage:&lt;/p&gt;
&lt;div class="highlight-sh notranslate"&gt;&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="ch"&gt;#!sh&lt;/span&gt;

&lt;span class="nv"&gt;self&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="k"&gt;$(&lt;/span&gt;realpath &lt;span class="nv"&gt;$0&lt;/span&gt;&lt;span class="k"&gt;)&lt;/span&gt;
&lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="o"&gt;[&lt;/span&gt; &lt;span class="nv"&gt;$self&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="si"&gt;${&lt;/span&gt;&lt;span class="nv"&gt;HOME&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;/gup/lib.sh &lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="k"&gt;then&lt;/span&gt;
    &lt;span class="nb"&gt;echo&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="nv"&gt;$0&lt;/span&gt;&lt;span class="s2"&gt;: Only for use within a gup file&amp;quot;&lt;/span&gt; &amp;gt;&lt;span class="p"&gt;&amp;amp;&lt;/span&gt;&lt;span class="m"&gt;2&lt;/span&gt;
    &lt;span class="nb"&gt;exit&lt;/span&gt; &lt;span class="m"&gt;255&lt;/span&gt;
&lt;span class="k"&gt;fi&lt;/span&gt;

&lt;span class="o"&gt;[&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="si"&gt;${&lt;/span&gt;&lt;span class="nv"&gt;GUP_XTRACE&lt;/span&gt;&lt;span class="k"&gt;:-&lt;/span&gt;&lt;span class="nv"&gt;0&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt; -eq &lt;span class="m"&gt;1&lt;/span&gt; &lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class="nb"&gt;set&lt;/span&gt; -x
&lt;span class="o"&gt;[&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="nv"&gt;$GUP_VERBOSE&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt; -ge &lt;span class="m"&gt;1&lt;/span&gt; &lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class="nb"&gt;set&lt;/span&gt; -v

&lt;span class="nb"&gt;set&lt;/span&gt; -eu

gup -u &lt;span class="nv"&gt;$self&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;Outside of my own projects I’ve never seen &lt;strong class="command"&gt;gup&lt;/strong&gt; in use, which anecdotally
makes it even less common than &lt;strong class="command"&gt;redo&lt;/strong&gt;.  Whether that is a deal breaker for you
isn’t for me to decide, but I would recommend that you check it out if you’re
considering using &lt;strong class="command"&gt;redo&lt;/strong&gt;.&lt;/p&gt;
&lt;p&gt;I want to add a final note that Tim is nice to work with.  I’ve filed bugs in
other projects that he maintains and it has been a good experience each time.
I’m sure you’ll get the same great service if you were to find a problem in
&lt;strong class="command"&gt;gup&lt;/strong&gt;!&lt;/p&gt;
&lt;/section&gt;
&lt;section id="ninja"&gt;
&lt;h2&gt;&lt;strong class="command"&gt;ninja&lt;/strong&gt;&lt;/h2&gt;
&lt;p&gt;Enter the &lt;a class="reference external" href="https://ninja-build.org/"&gt;ninja&lt;/a&gt;.  I’ve switched many projects to
&lt;strong class="command"&gt;ninja&lt;/strong&gt;, but not because it is my new favourite tool.  I’ve switched entirely
because it &lt;em&gt;feels&lt;/em&gt; like it has the momentum to supplant &lt;strong class="command"&gt;make&lt;/strong&gt;.  Given the
choice I’d honestly rather see a &lt;strong class="command"&gt;redo&lt;/strong&gt; implementation such as &lt;strong class="command"&gt;gup&lt;/strong&gt; succeed,
but &lt;strong class="command"&gt;ninja&lt;/strong&gt; is a great alternative.&lt;/p&gt;
&lt;aside class="sidebar"&gt;
&lt;p class="sidebar-title"&gt;Implementations&lt;/p&gt;
&lt;p&gt;In a &lt;em&gt;massive&lt;/em&gt; change from the previous sections I can mention a tool with
alternatives where compatibility is &lt;strong&gt;100%&lt;/strong&gt;.  &lt;a class="reference external" href="https://github.com/michaelforney/samurai/"&gt;samurai&lt;/a&gt; is an alternative
&lt;strong class="command"&gt;ninja&lt;/strong&gt; implementation which is drop-in replacement, without any
incompatible feature changes.  &lt;a class="reference external" href="http://shakebuild.com/"&gt;shake&lt;/a&gt; is an alternative build tool with
support for processing &lt;code class="file docutils literal notranslate"&gt;&lt;span class="pre"&gt;build.ninja&lt;/span&gt;&lt;/code&gt; baked in, and has some
interesting functionality for inspecting your builds that &lt;strong class="command"&gt;ninja&lt;/strong&gt; itself
doesn’t provide.&lt;/p&gt;
&lt;/aside&gt;
&lt;p&gt;I’ll make a confession here, my home directory now requires &lt;strong class="command"&gt;ninja&lt;/strong&gt;.  Yes, my
config files have made the progression from &lt;strong class="command"&gt;make&lt;/strong&gt; to &lt;strong class="command"&gt;redo&lt;/strong&gt; to &lt;strong class="command"&gt;gup&lt;/strong&gt; and now
to &lt;strong class="command"&gt;ninja&lt;/strong&gt;.&lt;/p&gt;
&lt;div class="highlight-console notranslate"&gt;&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="gp"&gt;$&lt;/span&gt; &lt;span class="nb"&gt;alias&lt;/span&gt; homeninja
&lt;span class="go"&gt;homeninja=&amp;#39;ninja -C ~ -j1&amp;#39;&lt;/span&gt;
&lt;span class="gp"&gt;$&lt;/span&gt; homeninja -t targets &lt;span class="p"&gt;|&lt;/span&gt; wc -l
&lt;span class="go"&gt;423&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;figure class="align-default" id="id15"&gt;
&lt;img alt="Digraph of home directory’s top level build" src="../../_images/homeninja.png" style="width: 390.25px; height: 186.25px;" /&gt;
&lt;figcaption&gt;
&lt;p&gt;&lt;span class="caption-text"&gt;A chunk of the &lt;abbr title="Directed Acyclic Graph"&gt;DAG&lt;/abbr&gt; for my home directory under &lt;strong class="command"&gt;ninja&lt;/strong&gt;.  The full image is
both &lt;em&gt;chock full&lt;/em&gt; of private data and 9 &lt;abbr title="MegaBytes"&gt;MB&lt;/abbr&gt;(29000 pixels
tall), so I’ll save all of us from that.&lt;/span&gt;&lt;/p&gt;
&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;p&gt;We’ve already seen a benefit of &lt;strong class="command"&gt;ninja&lt;/strong&gt; here, it can immediately display
a &lt;abbr title="Directed Acyclic Graph"&gt;DAG&lt;/abbr&gt; to help in debugging by giving the option &lt;code class="docutils literal notranslate"&gt;&lt;span class="pre"&gt;-t&lt;/span&gt; &lt;span class="pre"&gt;graph&lt;/span&gt;&lt;/code&gt;.  While both
&lt;strong class="command"&gt;gup&lt;/strong&gt; and &lt;strong class="command"&gt;redo&lt;/strong&gt; can be easily tamed to produce a simple &lt;a class="reference external" href="https://www.graphviz.org/"&gt;graphviz&lt;/a&gt; image as
above&lt;a class="footnote-reference brackets" href="#id12" id="id5"&gt;5&lt;/a&gt;, doing so with &lt;strong class="command"&gt;make&lt;/strong&gt; is very difficult&lt;a class="footnote-reference brackets" href="#id13" id="id6"&gt;6&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;&lt;strong class="command"&gt;ninja&lt;/strong&gt; shares a lot in common with &lt;strong class="command"&gt;redo&lt;/strong&gt;.  It automatically depends on its
build rules, and any changes to them cleanly ripple out through the build.  It
also makes adding computed dependencies very easy, although you need to mangle
them &lt;em&gt;in to&lt;/em&gt; &lt;strong class="command"&gt;make&lt;/strong&gt; format instead of extracting &lt;em&gt;from&lt;/em&gt; &lt;strong class="command"&gt;make&lt;/strong&gt; format as you
would have with &lt;strong class="command"&gt;redo&lt;/strong&gt;.  A quick example of how to make &lt;a class="reference external" href="http://docutils.sourceforge.net/"&gt;docutils&lt;/a&gt; dependencies
work is below:&lt;/p&gt;
&lt;div class="highlight-ini notranslate"&gt;&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="na"&gt;command&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;rst2html.py --record-dependencies $out.d.tmp $in $out; $&lt;/span&gt;
&lt;span class="s"&gt;    [ -f $out.d.tmp ] &amp;amp;&amp;amp; echo $out: $$(cat $out.d.tmp) &amp;gt; $out.d; $&lt;/span&gt;
&lt;span class="s"&gt;    rm -f $out.d.tmp&lt;/span&gt;
&lt;span class="na"&gt;depfile&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;$out.d&lt;/span&gt;
&lt;span class="na"&gt;deps&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;gcc&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;Of course we’re making trade offs at this point, and they are basically:&lt;/p&gt;
&lt;table class="docutils align-default"&gt;
&lt;colgroup&gt;
&lt;col style="width: 19%" /&gt;
&lt;col style="width: 29%" /&gt;
&lt;col style="width: 52%" /&gt;
&lt;/colgroup&gt;
&lt;thead&gt;
&lt;tr class="row-odd"&gt;&lt;th class="head"&gt;&lt;p&gt;Tool&lt;/p&gt;&lt;/th&gt;
&lt;th class="head"&gt;&lt;p&gt;Simple tasks&lt;/p&gt;&lt;/th&gt;
&lt;th class="head"&gt;&lt;p&gt;Complex tasks&lt;/p&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr class="row-even"&gt;&lt;td&gt;&lt;p&gt;&lt;strong class="command"&gt;make&lt;/strong&gt;&lt;/p&gt;&lt;/td&gt;
&lt;td&gt;&lt;p&gt;Easy&lt;/p&gt;&lt;/td&gt;
&lt;td&gt;&lt;p&gt;Tricky, and brittle&lt;/p&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class="row-odd"&gt;&lt;td&gt;&lt;p&gt;&lt;strong class="command"&gt;redo&lt;/strong&gt;&lt;/p&gt;&lt;/td&gt;
&lt;td&gt;&lt;p&gt;Easy&lt;/p&gt;&lt;/td&gt;
&lt;td&gt;&lt;p&gt;Repetitive, but simple&lt;/p&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class="row-even"&gt;&lt;td&gt;&lt;p&gt;&lt;strong class="command"&gt;ninja&lt;/strong&gt;&lt;/p&gt;&lt;/td&gt;
&lt;td&gt;&lt;p&gt;Easy&lt;/p&gt;&lt;/td&gt;
&lt;td&gt;&lt;p&gt;Offload to another tool&lt;/p&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;&lt;strong class="command"&gt;ninja&lt;/strong&gt; really does make the easy parts easy, and there are a variety of tools
to work with more complex builds.  You might even find you can get away with
a tiny bit of scripting around &lt;a class="reference external" href="https://pypi.python.org/pypi/ninja_syntax"&gt;ninja_syntax&lt;/a&gt;, but the manual work will
quickly build up with that approach.&lt;/p&gt;
&lt;section id="meson"&gt;
&lt;h3&gt;&lt;strong class="command"&gt;meson&lt;/strong&gt;&lt;/h3&gt;
&lt;p&gt;The &lt;a class="reference external" href="http://mesonbuild.com/"&gt;meson build system&lt;/a&gt; is probably the frontrunner today.&lt;/p&gt;
&lt;p&gt;In a move that feels like it is simply meant to &lt;a class="reference external" href="http://suckless.org/philosophy/"&gt;annoy the people behind
suckless&lt;/a&gt; I use &lt;strong class="command"&gt;meson&lt;/strong&gt; to build my &lt;a class="reference external" href="https://dwm.suckless.org/"&gt;dwm&lt;/a&gt; configuration.  Not because it is in
an important choice, but solely because it was a small and simple package that
made learning the basics of &lt;strong class="command"&gt;meson&lt;/strong&gt; easier.  A trimmed down version of the
&lt;code class="file docutils literal notranslate"&gt;&lt;span class="pre"&gt;meson.build&lt;/span&gt;&lt;/code&gt; is below:&lt;/p&gt;
&lt;div class="highlight-default notranslate"&gt;&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="n"&gt;project&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;dwm&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;c&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="p"&gt;],&lt;/span&gt; &lt;span class="n"&gt;default_options&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;std=c99&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="p"&gt;],&lt;/span&gt; &lt;span class="n"&gt;license&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;MIT&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

&lt;span class="n"&gt;fontconfig_dep&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;dependency&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;fontconfig&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;x11_dep&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;dependency&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;x11&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;xft_dep&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;dependency&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;xft&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;xinerama_dep&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;dependency&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;xinerama&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;required&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;false&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;xinerama_dep&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;found&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
    &lt;span class="n"&gt;add_project_arguments&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;-DXINERAMA&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;language&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;c&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;endif&lt;/span&gt;

&lt;span class="n"&gt;config_h&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;custom_target&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;gen-config&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nb"&gt;input&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;config.def.h&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
                         &lt;span class="n"&gt;output&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;config.h&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
                         &lt;span class="n"&gt;command&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;cp&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;--no-clobber&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;@INPUT@&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
                                   &lt;span class="s1"&gt;&amp;#39;@OUTPUT@&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;])&lt;/span&gt;

&lt;span class="n"&gt;executable&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;dwm&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;drw.c&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;dwm.c&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;util.c&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;config_h&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt;
           &lt;span class="n"&gt;dependencies&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;fontconfig_dep&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;x11_dep&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;xft_dep&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;xinerama_dep&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt;
           &lt;span class="n"&gt;install&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;true&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

&lt;span class="n"&gt;install_man&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;dwm.1&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;This is broadly comparable with an &lt;a class="reference external" href="https://www.gnu.org/software/autoconf/"&gt;autoconf&lt;/a&gt; and &lt;a class="reference external" href="https://www.gnu.org/software/automake/"&gt;automake&lt;/a&gt; solution for
a similar task, albeit with far less behind the scenes complexity.  It is
a superior solution to upstream’s choice of hand editing a &lt;code class="file docutils literal notranslate"&gt;&lt;span class="pre"&gt;Makefile&lt;/span&gt;&lt;/code&gt;, as
it handles rebuilds when you change options automatically too.&lt;/p&gt;
&lt;p&gt;&lt;strong class="command"&gt;meson&lt;/strong&gt; supports many languages out of the box; C, C++, &lt;a class="reference external" href="https://wiki.gnome.org/Projects/Vala"&gt;vala&lt;/a&gt;, &lt;a class="reference external" href="https://www.rust-lang.org/"&gt;rust&lt;/a&gt;, &amp;amp;c.  If
you find yourself needing to add your own it is quite simple, just subclass
&lt;a class="reference external" href="https://github.com/mesonbuild/meson/blob/master/mesonbuild/compilers/compilers.py"&gt;Compiler&lt;/a&gt; and set a few methods.  It took less than five minutes to add support
for the transpiler we use on some of our projects&lt;a class="footnote-reference brackets" href="#id14" id="id7"&gt;7&lt;/a&gt;, and probably another 10
a few weeks later to tighten it up and add tests when &lt;strong class="command"&gt;meson&lt;/strong&gt; support was
merged.&lt;/p&gt;
&lt;p&gt;In fact because &lt;strong class="command"&gt;meson&lt;/strong&gt; is such a well defined wrapper around &lt;strong class="command"&gt;ninja&lt;/strong&gt; I’d
recommend it &lt;em&gt;after&lt;/em&gt; &lt;strong class="command"&gt;ninja&lt;/strong&gt;.  If you start a small project where a simple
static &lt;code class="file docutils literal notranslate"&gt;&lt;span class="pre"&gt;build.ninja&lt;/span&gt;&lt;/code&gt; is enough, then “upgrading” to &lt;strong class="command"&gt;meson&lt;/strong&gt; &lt;em&gt;iff&lt;/em&gt; the
need arises at some point is really easy.&lt;/p&gt;
&lt;div class="admonition hint"&gt;
&lt;p class="admonition-title"&gt;Hint&lt;/p&gt;
&lt;p&gt;Co-workers can see this in action in the &lt;code class="docutils literal notranslate"&gt;&lt;span class="pre"&gt;zephyr_ground_station&lt;/span&gt;&lt;/code&gt;
repository.  I started out with mock up graphics from the Zephyr spec,
added a manual &lt;code class="file docutils literal notranslate"&gt;&lt;span class="pre"&gt;build.ninja&lt;/span&gt;&lt;/code&gt; as I started to code the interface,
switched to a simple generated file using &lt;strong class="command"&gt;ninja&lt;/strong&gt;’s &lt;a class="reference external" href="https://pypi.python.org/pypi/ninja_syntax"&gt;ninja_syntax&lt;/a&gt;
module when the project grew, and eventually changed to &lt;strong class="command"&gt;meson&lt;/strong&gt; with a few
edits when the project was eventually greenlit.  It was a really clean
process, and one I’d follow again.&lt;/p&gt;
&lt;/div&gt;
&lt;/section&gt;
&lt;section id="googles-kati"&gt;
&lt;h3&gt;Google’s kati&lt;/h3&gt;
&lt;p&gt;&lt;a class="reference external" href="https://github.com/google/kati/"&gt;kati&lt;/a&gt; is a nice first step if you’re currently using &lt;strong class="command"&gt;make&lt;/strong&gt; and want to try out
&lt;strong class="command"&gt;ninja&lt;/strong&gt;.  It will generate a &lt;code class="file docutils literal notranslate"&gt;&lt;span class="pre"&gt;build.ninja&lt;/span&gt;&lt;/code&gt; from your &lt;code class="file docutils literal notranslate"&gt;&lt;span class="pre"&gt;Makefile&lt;/span&gt;&lt;/code&gt;,
but it won’t be very idiomatic.&lt;/p&gt;
&lt;p&gt;It does serve as an immediate example of the difference you get with a no-op
build from &lt;strong class="command"&gt;make&lt;/strong&gt; and &lt;strong class="command"&gt;ninja&lt;/strong&gt; though, and sometimes that alone feels like
enough to integrate &lt;code class="docutils literal notranslate"&gt;&lt;span class="pre"&gt;kati&lt;/span&gt;&lt;/code&gt; in to your build.&lt;/p&gt;
&lt;p&gt;Because it mechanically converts rules from &lt;strong class="command"&gt;make&lt;/strong&gt; to &lt;strong class="command"&gt;ninja&lt;/strong&gt; it is incredibly
verbose, but it does so in such a manner that it is easy to use the output as
a basis for full switch.&lt;/p&gt;
&lt;div class="admonition attention"&gt;
&lt;p class="admonition-title"&gt;Attention&lt;/p&gt;
&lt;p&gt;I should mention &lt;code class="docutils literal notranslate"&gt;&lt;span class="pre"&gt;cmake&lt;/span&gt;&lt;/code&gt; at least once, just so that readers know that
I’m aware of it.  I’m ignoring it because of its inscrutable syntax, its
&lt;em&gt;interesting&lt;/em&gt; &lt;a class="reference external" href="https://pkgconfig.freedesktop.org/wiki/"&gt;pkg-config&lt;/a&gt; story, its propensity for creating ten minute
multi-pass pre-build steps, and its love for running the &lt;strong class="command"&gt;cmake&lt;/strong&gt;
binary thousands of times in each build.&lt;/p&gt;
&lt;/div&gt;
&lt;/section&gt;
&lt;/section&gt;
&lt;section id="conclusions"&gt;
&lt;h2&gt;Conclusions&lt;/h2&gt;
&lt;p&gt;There are a lot of options available if you’re feeling growing pains with
&lt;strong class="command"&gt;make&lt;/strong&gt;, or are just looking to tighten up builds.  I’ve covered a few here, but
there are many more out there.  I’ve ignored a few excellent options that
fit within the realms of what we commonly refer to as a build system(&lt;a class="reference external" href="https://premake.github.io/"&gt;premake&lt;/a&gt;
and &lt;a class="reference external" href="http://gittup.org/tup"&gt;tup&lt;/a&gt; both spring to mind), in part because I don’t have enough real world
experience to comment on them.&lt;/p&gt;
&lt;p&gt;This has turned in to a much longer document than I had originally envisioned,
but I hope there is enough meat in to make that worthwhile.&lt;/p&gt;
&lt;p&gt;Finally, in much the same way I tend to finish my build system talks with an
offer to help in the final slide, I’ll add one here too.  If you’ve made it
this far and need a little help, don’t hesitate to get in &lt;span class="xref std std-doc"&gt;contact&lt;/span&gt;.&lt;/p&gt;
&lt;p class="rubric"&gt;Footnotes&lt;/p&gt;
&lt;dl class="footnote brackets"&gt;
&lt;dt class="label" id="id8"&gt;&lt;span class="brackets"&gt;&lt;a class="fn-backref" href="#id1"&gt;1&lt;/a&gt;&lt;/span&gt;&lt;/dt&gt;
&lt;dd&gt;&lt;p&gt;From today that should be no more.  I’ve added a rule to break the build
if you add a suffix rule, but I’m sure we’ll see some commentary on
whether that was the right way to pin it.&lt;/p&gt;
&lt;/dd&gt;
&lt;dt class="label" id="id9"&gt;&lt;span class="brackets"&gt;&lt;a class="fn-backref" href="#id2"&gt;2&lt;/a&gt;&lt;/span&gt;&lt;/dt&gt;
&lt;dd&gt;&lt;p&gt;For the projects I’m currently working the number of devs using systems
with pre-GPLv3 make is very low, but it is &lt;em&gt;entirely&lt;/em&gt; dependent on the
ecosystem of a given project.&lt;/p&gt;
&lt;/dd&gt;
&lt;dt class="label" id="id10"&gt;&lt;span class="brackets"&gt;&lt;a class="fn-backref" href="#id3"&gt;3&lt;/a&gt;&lt;/span&gt;&lt;/dt&gt;
&lt;dd&gt;&lt;p&gt;It is defined only in &lt;a class="reference external" href="http://cr.yp.to/redo.html"&gt;a collection of short descriptions&lt;/a&gt; on djb’s
website, and there is no known reference implementation.&lt;/p&gt;
&lt;/dd&gt;
&lt;dt class="label" id="id11"&gt;&lt;span class="brackets"&gt;&lt;a class="fn-backref" href="#id4"&gt;4&lt;/a&gt;&lt;/span&gt;&lt;/dt&gt;
&lt;dd&gt;&lt;p&gt;This is defintely not true of &lt;strong class="command"&gt;make&lt;/strong&gt; requirements, I’ve seen many
ridiculously angry bugs filed when builds only work with &lt;a class="reference external" href="https://www.gnu.org/software/make/make.html"&gt;GNU make&lt;/a&gt;.&lt;/p&gt;
&lt;/dd&gt;
&lt;dt class="label" id="id12"&gt;&lt;span class="brackets"&gt;&lt;a class="fn-backref" href="#id5"&gt;5&lt;/a&gt;&lt;/span&gt;&lt;/dt&gt;
&lt;dd&gt;&lt;p&gt;Avery Pennarun’s &lt;a class="reference external" href="https://github.com/apenwarr/redo/"&gt;Python implementation&lt;/a&gt; of &lt;strong class="command"&gt;redo&lt;/strong&gt; stores it dependency
data in a &lt;a class="reference external" href="https://sqlite.org/"&gt;sqlite&lt;/a&gt; database named &lt;code class="file docutils literal notranslate"&gt;&lt;span class="pre"&gt;.redo/redo.sqlite3&lt;/span&gt;&lt;/code&gt;, making it
is easy to transform in to a &lt;strong class="command"&gt;dot&lt;/strong&gt; compliant input.  For
instance, here is my &lt;code class="docutils literal notranslate"&gt;&lt;span class="pre"&gt;dzen2&lt;/span&gt;&lt;/code&gt; tree as built by &lt;strong class="command"&gt;redo&lt;/strong&gt;:&lt;/p&gt;
&lt;img alt="Digraph of dzen2 build with redo" src="../../_images/dzen.png" style="width: 487.41px; height: 163.68px;" /&gt;
&lt;/dd&gt;
&lt;dt class="label" id="id13"&gt;&lt;span class="brackets"&gt;&lt;a class="fn-backref" href="#id6"&gt;6&lt;/a&gt;&lt;/span&gt;&lt;/dt&gt;
&lt;dd&gt;&lt;p&gt;A search yields a few attempts to do so, many requiring large runtimes
and all with a list of limitations likely to fall far below a projects
actual usage of &lt;strong class="command"&gt;make&lt;/strong&gt;.  The two I popped open rely on parsing the
output from &lt;strong class="command"&gt;make -pn&lt;/strong&gt; for example, and neither took in to
account &lt;code class="docutils literal notranslate"&gt;&lt;span class="pre"&gt;+&lt;/span&gt;&lt;/code&gt; code execution either.&lt;/p&gt;
&lt;/dd&gt;
&lt;dt class="label" id="id14"&gt;&lt;span class="brackets"&gt;&lt;a class="fn-backref" href="#id7"&gt;7&lt;/a&gt;&lt;/span&gt;&lt;/dt&gt;
&lt;dd&gt;&lt;p&gt;If you need a custom compiler the &lt;a class="reference external" href="https://github.com/mesonbuild/meson/blob/master/mesonbuild/compilers/vala.py"&gt;vala support&lt;/a&gt; is probably a good
starting point as it is not too complex, and implements a good subset of
required interface.&lt;/p&gt;
&lt;/dd&gt;
&lt;/dl&gt;
&lt;/section&gt;
&lt;/section&gt;
</content>
    <link href="https://jnrowe.github.io/articles/redo_ninja_make.html" rel="alternate"/>
    <summary>This is a massive brain dump, which I plan to rewrite in to a series at
some point.  However, until that imaginary date arrives…Digraph of home directory’s top level build</summary>
    <category term="tools" label="tools"/>
    <category term="build" label="build"/>
    <category term="make" label="make"/>
    <category term="ninja" label="ninja"/>
    <category term="redo" label="redo"/>
    <published>2018-11-23T00:00:00+00:00</published>
  </entry>
  <entry>
    <id>https://jnrowe.github.io/articles/new_love_giddiness.html</id>
    <title>Giddy new project love</title>
    <updated>2018-12-04T00:00:00+00:00</updated>
    <author>
      <name>James Rowe</name>
    </author>
    <content type="html">&lt;section id="giddy-new-project-love"&gt;

&lt;p&gt;I’ve recently inherited a new tier-one project, which is great news!  Sadly, it
is in real need of some Tender Loving Care™.  Was there ever an inherited
project that wasn’t?&lt;/p&gt;
&lt;p&gt;The project is our semi-custom transpiler for &lt;a class="reference external" href="https://en.m.wikipedia.org/wiki/Ada_(programming_language)"&gt;Ada&lt;/a&gt; affectionately called
&lt;code class="docutils literal notranslate"&gt;&lt;span class="pre"&gt;sandfly&lt;/span&gt;&lt;/code&gt;.  I say semi-custom as it was spun out from a consortium effort to
“facilitate reliability and improve portability” of &lt;code class="docutils literal notranslate"&gt;&lt;span class="pre"&gt;Ada&lt;/span&gt;&lt;/code&gt; projects, which is
a far loftier sounding goal than it need be.  In essence, it is the
codification of rules and guidelines we’ve adhered to since a partner meeting
in &lt;em&gt;1996&lt;/em&gt;, and that we find ourselves still following today&lt;a class="footnote-reference brackets" href="#id4" id="id1"&gt;1&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;I wasn’t around back when the original group was formed, and it was disbanded
before I’d even heard of &lt;code class="docutils literal notranslate"&gt;&lt;span class="pre"&gt;Ada&lt;/span&gt;&lt;/code&gt;.  This project is genuinely
multi-generational, which &lt;em&gt;feels&lt;/em&gt; nice.  All too often our work in software can
feel ephemeral; squeaked on a whiteboard in the morning, tapped in to
a computer in the afternoon and swept away by the janitors as night falls.&lt;/p&gt;
&lt;section id="hopes-and-dreams"&gt;
&lt;h2&gt;Hopes and dreams&lt;/h2&gt;
&lt;p&gt;As the project &lt;em&gt;should&lt;/em&gt; have significant longevity I find myself pondering the
future.  &lt;em&gt;If&lt;/em&gt; I could change things for the next 20 years, what should I do to
make that experience better?  Should I do &lt;em&gt;nothing at all&lt;/em&gt; and just chug along
reducing the anxiety that even small changes will evoke?&lt;/p&gt;
&lt;p&gt;I also find myself pondering the present.  Could a truly radical change &lt;em&gt;today&lt;/em&gt;
obviate the need for this project entirely before the next maintainer grabs the
reins for their reign of anxiety?  Would that necessarily be a good thing?&lt;/p&gt;
&lt;aside class="sidebar"&gt;
&lt;p class="sidebar-title"&gt;Common errors&lt;/p&gt;
&lt;p&gt;I’ve always considered it odd that we can choose to attach a listing of
common errors to a product and expect people to use it.  If we know it is
common for users to make critical errors because of a design decision we
need to make a new design, not a new bullet point on the list.&lt;/p&gt;
&lt;p&gt;Even simple things like watching an &lt;code class="docutils literal notranslate"&gt;&lt;span class="pre"&gt;Ada&lt;/span&gt;&lt;/code&gt; beginner make the classic
“atomic means atomic” mistake should be designed out, and not &lt;em&gt;solved&lt;/em&gt; with
an addendum of “protected objects mean atomic” chicanery.&lt;/p&gt;
&lt;/aside&gt;
&lt;p&gt;Many of the advantages that we associate with &lt;code class="docutils literal notranslate"&gt;&lt;span class="pre"&gt;Ada&lt;/span&gt;&lt;/code&gt; — such as its mighty type
safety — no longer feel that advanced or remotely unique.  Even “hobby”
languages such as &lt;a class="reference external" href="https://nim-lang.org/"&gt;nim&lt;/a&gt; implement many of the safety features we expect from
&lt;code class="docutils literal notranslate"&gt;&lt;span class="pre"&gt;Ada&lt;/span&gt;&lt;/code&gt; implementations&lt;a class="footnote-reference brackets" href="#id5" id="id2"&gt;2&lt;/a&gt;; subrange types being a fine example where the
&lt;code class="docutils literal notranslate"&gt;&lt;span class="pre"&gt;nim&lt;/span&gt;&lt;/code&gt; designers have absorbed an &lt;code class="docutils literal notranslate"&gt;&lt;span class="pre"&gt;Ada&lt;/span&gt;&lt;/code&gt; feature.  And standard everyday
languages now often have tooling that is capable of providing &lt;em&gt;many&lt;/em&gt; of the
benefits of &lt;code class="docutils literal notranslate"&gt;&lt;span class="pre"&gt;Ada&lt;/span&gt;&lt;/code&gt;, and one should really only expect this to increase.&lt;/p&gt;
&lt;p&gt;What really hammers home the point here is that a good number of the features
one thinks about weren’t even available in &lt;code class="docutils literal notranslate"&gt;&lt;span class="pre"&gt;Ada&lt;/span&gt;&lt;/code&gt; when &lt;code class="docutils literal notranslate"&gt;&lt;span class="pre"&gt;sandfly&lt;/span&gt;&lt;/code&gt; began; fex
contracts are from &lt;a class="reference external" href="http://www.ada2012.org/"&gt;Ada 2012&lt;/a&gt;.  Will languages leapfrog &lt;code class="docutils literal notranslate"&gt;&lt;span class="pre"&gt;Ada&lt;/span&gt;&lt;/code&gt; in its niche
by borrowing and then sprint away by innovating as their uptake increases?&lt;/p&gt;
&lt;/section&gt;
&lt;section id="benefits-of-transpilation"&gt;
&lt;h2&gt;Benefits of transpilation&lt;/h2&gt;
&lt;p&gt;The original &lt;code class="docutils literal notranslate"&gt;&lt;span class="pre"&gt;sandfly&lt;/span&gt;&lt;/code&gt; authors implemented a transpiler because it made
various checks simpler to carry out.  According to the documentation, it was
never intended to become a full blown language in its own right… which of
course it has.&lt;/p&gt;
&lt;p&gt;Maybe we should take the opportunity to stay on top of the changing language
landscape thanks to the side effect of &lt;code class="docutils literal notranslate"&gt;&lt;span class="pre"&gt;sandfly&lt;/span&gt;&lt;/code&gt;’s implementation details.
Given that we’re already transpiling should we consider alternative targets?
&lt;a class="reference external" href="http://www.ocaml.org/"&gt;ocaml&lt;/a&gt; is the language that immediately jumps to mind, as it is syntactically
close to &lt;code class="docutils literal notranslate"&gt;&lt;span class="pre"&gt;sandfly&lt;/span&gt;&lt;/code&gt; and it has an excellent type system.  And once you have
&lt;code class="docutils literal notranslate"&gt;&lt;span class="pre"&gt;ocaml&lt;/span&gt;&lt;/code&gt; it is a smaller step to &lt;a class="reference external" href="http://fsharp.org/"&gt;F#&lt;/a&gt; thanks to its legacy &lt;code class="docutils literal notranslate"&gt;&lt;span class="pre"&gt;ocaml&lt;/span&gt;&lt;/code&gt; mode.&lt;/p&gt;
&lt;p&gt;The code base is amenable to multiple targets already.  A couple of years ago
I implemented support for testing without relying on the support kernel
supplied by our compiler vendor&lt;a class="footnote-reference brackets" href="#id6" id="id3"&gt;3&lt;/a&gt;.  At its base &lt;code class="docutils literal notranslate"&gt;&lt;span class="pre"&gt;sandfly&lt;/span&gt;&lt;/code&gt; will optionally
generate &lt;a class="reference external" href="http://www.lua.org/"&gt;lua&lt;/a&gt; bytecode that is loaded in to a tiny emulator which can be driven
by other &lt;code class="docutils literal notranslate"&gt;&lt;span class="pre"&gt;lua&lt;/span&gt;&lt;/code&gt; scripts to test an implementation.  Its main purpose was to
allow early experimentation without the expense and time of waiting for
hardware re-fabrication.&lt;/p&gt;
&lt;figure class="align-default" id="id7"&gt;
&lt;img alt="sandfly debug architecture" src="../../_images/sandfly_use.png" style="width: 279.5px; height: 358.0px;" /&gt;
&lt;figcaption&gt;
&lt;p&gt;&lt;span class="caption-text"&gt;As you can see from example usage, it’s source-to-source all the way down.
If I’m writing &lt;code class="docutils literal notranslate"&gt;&lt;span class="pre"&gt;lua&lt;/span&gt;&lt;/code&gt; I’m using &lt;a class="reference external" href="https://github.com/leafo/moonscript/"&gt;moonscript&lt;/a&gt;, and so should you!&lt;/span&gt;&lt;/p&gt;
&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;p&gt;I’m not sure it would even be a great stretch to change the main target, there
would likely be significant support for it in fact.  It has already been
suggested that we should exclusively switch to &lt;a class="reference external" href="https://en.m.wikipedia.org/wiki/SPARK_(programming_language)"&gt;spark&lt;/a&gt; on a number of occasions,
especially since the reformation in Spark 2014.  If we could figure out the
safety certification story I’m sure there would be a lot of traction for &lt;code class="docutils literal notranslate"&gt;&lt;span class="pre"&gt;F#&lt;/span&gt;&lt;/code&gt;
as default.&lt;/p&gt;
&lt;/section&gt;
&lt;section id="final-thoughts"&gt;
&lt;h2&gt;Final thoughts&lt;/h2&gt;
&lt;aside class="sidebar"&gt;
&lt;p class="sidebar-title"&gt;Open Sourcing &lt;code class="docutils literal notranslate"&gt;&lt;span class="pre"&gt;sandfly&lt;/span&gt;&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;There have been a few enquiries as to whether this work is Open Source, and
sadly it isn’t.  However, if you work for one of the Atlas Consortium
companies(or a significant partner of one) it is easy to arrange “source
available” access.  I &lt;em&gt;know&lt;/em&gt; this isn’t the same thing, but it is the
current situation.&lt;/p&gt;
&lt;p&gt;The good news is that I’ve added an item to the issue tracker that includes
making it Open Source, the bad news is that there is a lot of work needed
— both by me and &lt;em&gt;many&lt;/em&gt; others — to make that happen.  I’ve kicked the
initial process off by contacting legal for guidance, we’ll see what
happens.&lt;/p&gt;
&lt;/aside&gt;
&lt;p&gt;I’ve always really appreciated &lt;a class="reference external" href="https://en.m.wikipedia.org/wiki/Vala_(programming_language)"&gt;vala&lt;/a&gt;’s alternative syntax support; &lt;a class="reference external" href="https://en.m.wikipedia.org/wiki/C_Sharp_(programming_language)"&gt;C#&lt;/a&gt; by
default, but with first class support for &lt;a class="reference external" href="https://en.m.wikipedia.org/wiki/Genie_(programming_language)"&gt;genie&lt;/a&gt;’s &lt;a class="reference external" href="http://boo-lang.org/"&gt;boo&lt;/a&gt;-inspired syntax.
I find myself thinking how nice it would be to emulate that and have multiple
frontends, &lt;em&gt;and&lt;/em&gt; the previously described backends.&lt;/p&gt;
&lt;p&gt;In fact I find myself thinking about &lt;code class="docutils literal notranslate"&gt;&lt;span class="pre"&gt;vala&lt;/span&gt;&lt;/code&gt; a lot as I write this.  It never
had the uptake I would have hoped for when I first read about it.  It has
however had a &lt;em&gt;huge&lt;/em&gt; impact in the places where it has been used.  That surely
makes it a great role model for &lt;code class="docutils literal notranslate"&gt;&lt;span class="pre"&gt;sandfly&lt;/span&gt;&lt;/code&gt; going forward.  It is better to be
an elusive Aston Martin &lt;a class="reference external" href="https://en.m.wikipedia.org/wiki/Aston_Martin_DB5"&gt;DB-5&lt;/a&gt; than a common as muck &lt;a class="reference external" href="https://en.m.wikipedia.org/wiki/Ford_Focus"&gt;Ford Focus&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;So, I’m deep in a pre-reality dream state where I want to add heaps of amazing
new features and functionality, coupled with a cold light of day feeling that
it could be nice to kill the project by transforming it in to a gateway out of
&lt;code class="docutils literal notranslate"&gt;&lt;span class="pre"&gt;Ada&lt;/span&gt;&lt;/code&gt;.  It could be the best &lt;em&gt;or&lt;/em&gt; worst project in the history of the world!
I’m genuinely excited.&lt;/p&gt;
&lt;p class="rubric"&gt;Footnotes&lt;/p&gt;
&lt;dl class="footnote brackets"&gt;
&lt;dt class="label" id="id4"&gt;&lt;span class="brackets"&gt;&lt;a class="fn-backref" href="#id1"&gt;1&lt;/a&gt;&lt;/span&gt;&lt;/dt&gt;
&lt;dd&gt;&lt;p&gt;It should be easy to guess why this project is being handed on, given
that we’re talking about a twenty-one year old endeavour.&lt;/p&gt;
&lt;/dd&gt;
&lt;dt class="label" id="id5"&gt;&lt;span class="brackets"&gt;&lt;a class="fn-backref" href="#id2"&gt;2&lt;/a&gt;&lt;/span&gt;&lt;/dt&gt;
&lt;dd&gt;&lt;p&gt;This isn’t meant to disparage &lt;a class="reference external" href="https://nim-lang.org/"&gt;nim&lt;/a&gt;, as it is really quite interesting.
I mean it purely in the sense that we haven’t &lt;em&gt;yet&lt;/em&gt; seen large industry
adoption.&lt;/p&gt;
&lt;/dd&gt;
&lt;dt class="label" id="id6"&gt;&lt;span class="brackets"&gt;&lt;a class="fn-backref" href="#id3"&gt;3&lt;/a&gt;&lt;/span&gt;&lt;/dt&gt;
&lt;dd&gt;&lt;p&gt;I’m of the &lt;em&gt;strong&lt;/em&gt; opinion that vendors who forbid you from naming,
shaming and even benchmarking them should be avoided at &lt;em&gt;all costs&lt;/em&gt;.
However, I’m not on the procurement board and didn’t get to make that
decision.&lt;/p&gt;
&lt;/dd&gt;
&lt;/dl&gt;
&lt;/section&gt;
&lt;/section&gt;
</content>
    <link href="https://jnrowe.github.io/articles/new_love_giddiness.html" rel="alternate"/>
    <summary>I’ve recently inherited a new tier-one project, which is great news!  Sadly, it
is in real need of some Tender Loving Care™.  Was there ever an inherited
project that wasn’t?sandfly debug architecture</summary>
    <category term="tools" label="tools"/>
    <category term="projects" label="projects"/>
    <category term="languages" label="languages"/>
    <published>2018-12-04T00:00:00+00:00</published>
  </entry>
</feed>
